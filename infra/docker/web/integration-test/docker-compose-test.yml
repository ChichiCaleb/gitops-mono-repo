
networks:
  stack:
    name: stack
    external: false

services:
  database:
    container_name: database
    image: postgres
    restart: always
    volumes:
      - ./healthchecks:/healthchecks

    environment:
       POSTGRES_USER: postgres
       POSTGRES_PASSWORD: postgres
    networks:
      - stack

  calcom:
    image: "${TESTING_IMAGE}"
   
    restart: always
    networks:
      - stack
    ports:
      - 3000:3000

    environment:
     
      DATABASE_URL: postgresql://postgres:postgres@database:5432/calcom
    depends_on:
      - database
  sut:
    image: "${TESTING_IMAGE}"
    depends_on:
      calcom:
        condition: service_started
      # database:
      #   condition: service_healthy
    # run all your tests here against the allhands22 service
    command: |
     curl  http://localhost:3000
    #  curl --fail http://localhost:3000 || exit 1
    
